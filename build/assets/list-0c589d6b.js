import{r as u,j as i,a as e}from"./index-234e4c88.js";import{l as C}from"./lodash-16a5b9a8.js";import{c as d,I as _,B as N,T as S,P as j,F as p,S as b,R as l}from"./fetch-99b62fec.js";import{d as E}from"./dayjs.min-bf0d876a.js";import{M as R}from"./index-e8b2fde6.js";import"./InfoCircleFilled-80a257bb.js";const{Option:r}=d,{confirm:v}=R;function B(){const[w,f]=u.useState([]),n=u.useRef({page:1,pageSize:20,count:0}),g=u.useRef({visible:"",user_name:"",terminal_type:"",corp_name:"",modifier_error:"未修复",error_type:"",assign_user_name:""}),c=async()=>{let t=await p.post("/error/list.rjson",{page:n.current.page,pageSize:n.current.pageSize,...g.current});n.current.count=t.count,f(t.list)},k=async t=>{v({title:"确认",content:"是否确认标记为已修复?",okText:"确认",cancelText:"取消",onOk:async()=>{await p.post("/error/list/state.rjson",{id:t}),c()},onCancel:()=>{console.log("cancel")}})},x=async t=>{let a="";const m=o=>{a=o.target.value};v({title:"指派人员",content:e("div",{children:i(l.Group,{onChange:m,children:[e(l,{value:"黑草",children:"黑草"}),e(l,{value:"大洋",children:"大洋"}),e(l,{value:"林木",children:"林木"}),e(l,{value:"夏天",children:"夏天"}),e(l,{value:"天晴",children:"天晴"}),e(l,{value:"竹风",children:"竹风"}),e(l,{value:"迷雾",children:"迷雾"})]})}),onOk:async()=>{await p.post("/error/assign/userName.rjson",{id:t,assign_user_name:a}),c()},onCancel(){console.log("Cancel")}})};u.useLayoutEffect(()=>{c()},[]);const y=[{title:"错误等级",dataIndex:"error_grade",key:"error_grade",width:100,fixed:"left",ellipsis:!0,render:(t,a)=>{const m=[{title:"紧急",classStr:"red",grade:"urgent"},{title:"高",classStr:"orange",grade:"high"},{title:"普通",classStr:"#1890ff",grade:"general"}],o=()=>C.keyBy(m,"grade")[a.error_count>=50?"urgent":a.error_count>=1&&a.error_count<10?"general":"high"];return e("span",{style:{color:o().classStr},children:o().title})}},{title:"指定修复人员",dataIndex:"assign_user_name",key:"assign_user_name",width:120},{title:"错误信息",dataIndex:"error_message",key:"error_message",ellipsis:!0,width:350},{title:"文件名称",dataIndex:"file_name",key:"file_name",width:450,ellipsis:!0},{title:"行",dataIndex:"line",key:"line",width:75,ellipsis:!0},{title:"列",dataIndex:"column",key:"column",width:75,ellipsis:!0},{title:"状态",dataIndex:"modifier_error",key:"modifier_error",width:100},{title:"id",dataIndex:"id",key:"id",width:100},{title:"新错误次数",dataIndex:"error_count",key:"error_count",width:120,ellipsis:!0},{title:"错误总次数",dataIndex:"count",key:"count",width:120,ellipsis:!0},{title:"问题名称",dataIndex:"name",key:"name",width:150,ellipsis:!0},{title:"错误类型",dataIndex:"error_type",key:"error_type",width:120,ellipsis:!0},{title:"环境",dataIndex:"visible",key:"visible",width:80,ellipsis:!0},{title:"设备",dataIndex:"terminal_type",key:"terminal_type",width:80,ellipsis:!0},{title:"hash",dataIndex:"hash",key:"hash",width:400,ellipsis:!0},{title:"唯一值",dataIndex:"key",key:"key",width:200,ellipsis:!0},{title:"用户",dataIndex:"user_name",key:"user_name",width:100,ellipsis:!0},{title:"企业",dataIndex:"corp_name",key:"corp_name",width:140,ellipsis:!0},{title:"错误跟踪",dataIndex:"log",key:"log",width:140,ellipsis:!0},{title:"时间",dataIndex:"created",key:"created",width:200,ellipsis:!0,render:t=>E(t).format("YYYY-MM-DD HH:mm:ss")},{title:"操作",key:"action",width:180,fixed:"right",render:(t,a)=>i(b,{size:"middle",children:[e("a",{onClick:()=>k(a.id),children:"修改"}),e("a",{onClick:()=>x(a.id),children:"指派修复人员"})]})}];let h=0;y.map(t=>{h=h+(t.width||200)});const I=t=>{n.current.page=t,c()},s=(t,a)=>{g.current[t]=a};return i("div",{className:"main JsErrorList",children:[i("div",{className:"content-header",children:["环境：",i(d,{className:"mr_12",style:{width:120},defaultValue:"",onChange:t=>s("visible",t),children:[e(r,{value:"",children:"所有"}),e(r,{value:"正式",children:"正式"}),e(r,{value:"测试",children:"测试"})]}),"状态：",i(d,{className:"mr_12",style:{width:120},defaultValue:"未修复",onChange:t=>s("modifier_error",t),children:[e(r,{value:"",children:"所有"}),e(r,{value:"已修复",children:"已修复"}),e(r,{value:"未修复",children:"未修复"})]}),"错误类型：",i(d,{className:"mr_12",style:{width:120},defaultValue:"",onChange:t=>s("error_type",t),children:[e(r,{value:"",children:"所有"}),e(r,{value:"js",children:"js"}),e(r,{value:"compRenderError",children:"compRenderError"})]}),"指派人员：",i(d,{className:"mr_12",style:{width:120},defaultValue:"",onChange:t=>s("assign_user_name",t),children:[e(r,{value:"",children:"所有"}),e(r,{value:"无",children:"未指派人员"}),e(r,{value:"黑草",children:"黑草"}),e(r,{value:"大洋",children:"大洋"}),e(r,{value:"林木",children:"林木"}),e(r,{value:"夏天",children:"夏天"}),e(r,{value:"天晴",children:"天晴"}),e(r,{value:"竹风",children:"竹风"}),e(r,{value:"迷雾",children:"迷雾"})]}),i(d,{className:"mr_12",style:{width:120},defaultValue:"",onChange:t=>s("terminal_type",t),children:[e(r,{value:"",children:"所有"}),e(r,{value:"mobile",children:"mobile"}),e(r,{value:"pc",children:"pc"})]}),"企业名称：",e(_,{className:"mr_12",style:{width:120},onChange:t=>s("corp_name",t.target.value)}),"用户名称：",e(_,{className:"mr_12",style:{width:120},onChange:t=>s("user_name",t.target.value)}),e(N,{type:"primary",className:"mr_12",onClick:c,children:"查询"})]}),e("div",{className:"content-table",children:e(S,{columns:y,dataSource:w,scroll:{x:h,y:window.innerHeight-200},pagination:!1})}),e("div",{className:"content-footer mt_12",children:e(j,{size:"small",total:n.current.count,onChange:I,current:n.current.page,pageSize:n.current.pageSize,showTotal:t=>`总条数${t}`})})]})}export{B as default};
